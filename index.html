<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crackio Store</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <!-- NAV -->
  <nav class="navbar">
    <ul class="nav-links">
      <li><a href="#">Inicio</a></li>
      <li class="submenu">
        <a href="#productos">Productos</a>
        <ul class="dropdown">
          <li><a href="#iluminacion">Iluminaci√≥n</a></li>
          <li><a href="#smart">Smart</a></li>
          <li><a href="#teclado">Teclado</a></li>
          <li><a href="#mouse">Mouse</a></li>
        </ul>
      </li>
      <li><a href="#contacto">Contacto</a></li>
    </ul>
  </nav>
<!-- √çCONO DE CARRITO -->
<div class="carrito-icono" onclick="mostrarCarrito()">
  üõí <span id="contador-carrito">0</span>
</div>

<!-- MODAL DEL CARRITO -->
<div id="modal-carrito" class="modal-carrito">
  <div class="modal-contenido">
    <span class="cerrar" onclick="cerrarCarrito()">&times;</span>
    <h2>Tu Carrito</h2>
    <div id="lista-carrito"></div>
    <!-- ‚úÖ Bot√≥n correcto, fuera del bucle -->
<button onclick="mostrarFormularioPedido()" class="boton-pedido">Finalizar pedido</button>
    <p id="total-carrito">Total: S/ 0.00</p>
  </div>
</div>
<!-- FORMULARIO DE PEDIDO -->
<div id="formulario-pedido" style="display: none;">
  <h3>Finalizar pedido</h3>
  <form id="pedidoForm">
    <label>Nombre:</label><br>
    <input type="text" id="nombreCliente" required><br><br>

    <label>Tel√©fono:</label><br>
    <input type="text" id="telefonoCliente" required><br><br>

    <label>Direcci√≥n:</label><br>
    <input type="text" id="direccionCliente" required><br><br>

    <label>M√©todo de pago:</label><br>
    <select id="metodoPago">
      <option value="Yape">Yape</option>
      <option value="Plin">Plin</option>
      <option value="Efectivo">Efectivo</option>
    </select><br><br>

    <label>Notas (opcional):</label><br>
    <textarea id="notasCliente" rows="3"></textarea><br><br>
   <button type="button" id="btn-enviar-pedido">Enviar Pedido por WhatsApp</button>
  </form>
</div>

  <!-- BANNER -->
  <div class="banner">
    <img src="images/Banner2.png" alt="Banner Crackio Store" />
  </div>

  <!-- PRODUCTOS -->
  <section class="productos" id="productos">
    <h2>Nuestros Productos</h2>
    <div id="contenedor-productos" class="contenedor-productos"></div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" class="contacto">
    <h2>Cont√°ctanos</h2>
    <p>¬øTienes dudas? Escr√≠benos a nuestro WhatsApp o por redes sociales.</p>
    <p><strong>Email:</strong> contacto@crackio.com</p>
    <p><strong>WhatsApp:</strong> +51 999 207 025</p>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="redes-sociales">
      <a href="https://www.facebook.com/people/Crakcio-Store/61578344680156/?locale=es_LA" target="_blank"><i class="fab fa-facebook"></i></a>
      <a href="https://wa.me/+51999207025" target="_blank"><i class="fab fa-whatsapp"></i></a>
      <a href="https://www.instagram.com/crakciostore/" target="_blank"><i class="fab fa-instagram"></i></a>
    </div>
    <p>&copy; 2025 Crackio Store. Todos los derechos reservados.</p>
  </footer>

  <!-- SCRIPT: Productos desde Supabase -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const SUPABASE_URL = 'https://twznikjjvtoedfaxbuvf.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3em5pa2pqdnRvZWRmYXhidXZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMyOTI1NDAsImV4cCI6MjA2ODg2ODU0MH0.aOQ10hq-syYqrenvFxveBQj6wKqdDtsDKfykSm42MFE';

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    async function cargarProductos() {
      const { data: productos, error } = await supabase
        .from('productos')
        .select('*');

      if (error) {
        console.error("Error al cargar productos:", error);
        return;
      }

      const contenedor = document.getElementById("contenedor-productos");
      contenedor.innerHTML = "";

      productos.forEach((producto) => {
        const div = document.createElement("div");
        div.classList.add("producto-card");
       div.innerHTML = `
  <img class="producto-img" src="${producto.imagen_url}" alt="${producto.nombre}" />
  <h3>${producto.nombre}</h3>
  <p>${producto.descripcion}</p>
  <p class="precio">S/ ${producto.precio.toFixed(2)}</p>
  <p class="stock">${producto.stock > 0 ? `Stock: ${producto.stock}` : '<span style="color:red">Agotado</span>'}</p>
  ${producto.stock > 0 ? `<button onclick='agregarAlCarrito(${JSON.stringify(producto)})'>Agregar al carrito</button>` : ''}
`;

        contenedor.appendChild(div);
      });
    }

    cargarProductos();
  </script>
  <script>
  let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

  function agregarAlCarrito(producto) {
    const index = carrito.findIndex(p => p.id === producto.id);
    if (index > -1) {
      carrito[index].cantidad += 1;
    } else {
      carrito.push({ ...producto, cantidad: 1 });
    }
    actualizarCarrito();
  }

  function mostrarCarrito() {
    document.getElementById('modal-carrito').style.display = 'block';
    renderizarCarrito();
  }

  function cerrarCarrito() {
    document.getElementById('modal-carrito').style.display = 'none';
  }

  function eliminarDelCarrito(id) {
    carrito = carrito.filter(p => p.id !== id);
    actualizarCarrito();
  }

  function actualizarCarrito() {
    localStorage.setItem('carrito', JSON.stringify(carrito));
    document.getElementById('contador-carrito').innerText = carrito.reduce((acc, p) => acc + p.cantidad, 0);
    renderizarCarrito();
  }

  function renderizarCarrito() {
    const lista = document.getElementById('lista-carrito');
    const total = document.getElementById('total-carrito');
    lista.innerHTML = '';
    if (carrito.length === 0) {
    lista.innerHTML = "<p>Tu carrito est√° vac√≠o.</p>";
    total.innerText = "Total: S/ 0.00";
    return;
  }

    let totalPrecio = 0;
    carrito.forEach(p => {
      totalPrecio += p.precio * p.cantidad;
      const div = document.createElement('div');
      div.classList.add('item-carrito');
      div.innerHTML = `
        <p><strong>${p.nombre}</strong> (x${p.cantidad}) - S/ ${(p.precio * p.cantidad).toFixed(2)}</p>
        <button onclick="eliminarDelCarrito(${p.id})">Eliminar</button>
      `;
      lista.appendChild(div);
    });
 // Bot√≥n para vaciar carrito
  const btnVaciar = document.createElement("button");
  btnVaciar.innerText = "Vaciar carrito";
  btnVaciar.onclick = () => {
    carrito = [];
    actualizarCarrito();
  };
  lista.appendChild(btnVaciar);
    total.innerText = `Total: S/ ${totalPrecio.toFixed(2)}`;
  }


  // Al cargar la p√°gina
  document.addEventListener("DOMContentLoaded", () => {
  actualizarCarrito();
});

</script>
<!-- Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const supabase = createClient(
    'https://TU_URL_SUPABASE.supabase.co',
    'TU_PUBLIC_ANON_KEY'
  );

  async function enviarPedidoASupabase(pedido) {
    const { data, error } = await supabase
      .from('pedidos')
      .insert([{
        total: pedido.total,
        estado: 'pendiente',
        detalles: pedido.productos // Debes crear este campo tipo JSONB en Supabase
      }]);

    if (error) {
      console.error('‚ùå Error al guardar el pedido en Supabase:', error);
      alert("Hubo un error al guardar tu pedido. Intenta nuevamente.");
    } else {
      console.log('‚úÖ Pedido guardado en Supabase:', data);
      abrirWhatsApp(pedido); // Abrimos WhatsApp despu√©s de guardar
    }
  }

  function abrirWhatsApp(pedido) {
    let mensaje = `üõí *Nuevo pedido Crackio Store*:%0A`;

    pedido.productos.forEach(p => {
      mensaje += `- ${p.nombre} x${p.cantidad} (S/ ${p.precio_unitario})%0A`;
    });

    mensaje += `%0Aüíµ *Total:* S/ ${pedido.total.toFixed(2)}`;
    const numero = "51999207025"; // Cambia por tu n√∫mero con c√≥digo pa√≠s
    const url = `https://wa.me/${numero}?text=${mensaje}`;
    window.open(url, "_blank");
  }

</script>
<footer class="footer">
  <p>&copy; 2025 Crackio Store. Todos los derechos reservados.</p>
  <a href="politica.html">Pol√≠tica de Privacidad</a> | 
  <a href="condiciones.html">Condiciones de Compra</a>
</footer>
<script type="module">
  // Configuraci√≥n de Supabase
  const supabaseUrl = 'https://TU-PROYECTO.supabase.co';
  const supabaseKey = 'TU-API-KEY-PUBLICA';
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  // Funci√≥n para obtener productos del carrito (ajusta seg√∫n c√≥mo los almacenes)
  function obtenerCarrito() {
    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    return carrito;
  }

  document.getElementById('pedidoForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const nombre = document.getElementById('nombreCliente').value;
    const telefono = document.getElementById('telefonoCliente').value;
    const direccion = document.getElementById('direccionCliente').value;
    const metodoPago = document.getElementById('metodoPago').value;
    const notas = document.getElementById('notasCliente').value;
    const productos = obtenerCarrito();

    const total = productos.reduce((acc, prod) => acc + (prod.precio * prod.cantidad), 0);

    const { data, error } = await supabase
      .from('pedidos')
      .insert([{
        nombre_cliente: nombre,
        telefono,
        direccion,
        metodo_pago: metodoPago,
        notas,
        productos,
        total,
        estado: 'pendiente'
      }]);

    if (error) {
      alert('Error al registrar pedido: ' + error.message);
      console.error(error);
    } else {
  alert('¬°Pedido enviado con √©xito!');
  localStorage.removeItem('carrito');

  // Abre WhatsApp despu√©s de guardar
  enviarPedidoWhatsApp();

  // Espera un poco antes de recargar
  setTimeout(() => {
    location.reload();
  }, 3000);
}
  });
</script>

<!-- Incluye Supabase (si no lo has hecho ya) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
function enviarPedidoWhatsApp() {
  const nombre = document.getElementById("nombreCliente").value;
  const direccion = document.getElementById("direccionCliente").value;
  const telefono = document.getElementById("telefonoCliente").value;
  const metodoPago = document.getElementById("metodoPago").value;
  const notas = document.getElementById("notasCliente").value;

  const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
  if (carrito.length === 0) {
    alert("Tu carrito est√° vac√≠o.");
    return;
  }

  let mensaje = "*üõí Nuevo pedido desde Crackio Store*%0A";
  mensaje += `üë§ *Nombre:* ${nombre}%0A`;
  mensaje += `üìû *Tel√©fono:* ${telefono}%0A`;
  mensaje += `üìç *Direcci√≥n:* ${direccion}%0A`;
  mensaje += `üí≥ *M√©todo de pago:* ${metodoPago}%0A`;
  if (notas) mensaje += `üìù *Notas:* ${notas}%0A`;

  mensaje += `%0A*Productos:*%0A`;
  carrito.forEach((item, index) => {
    mensaje += `${index + 1}. ${item.nombre} x${item.cantidad} - S/ ${item.precio}%0A`;
  });

  const total = carrito.reduce((acc, p) => acc + p.precio * p.cantidad, 0);
  mensaje += `%0Aüíµ *Total:* S/ ${total.toFixed(2)}`;

  const numeroWhatsApp = "51999207025";
  const url = `https://wa.me/${numeroWhatsApp}?text=${mensaje}`;
  window.open(url, "_blank");
}

// Conecta el bot√≥n cuando se cargue el DOM
document.addEventListener("DOMContentLoaded", () => {
  const boton = document.getElementById("btn-enviar-pedido");
  if (boton) {
    boton.addEventListener("click", enviarPedidoWhatsApp);
  }
});
</script>
<script>
  function mostrarFormularioPedido() {
    document.getElementById("formulario-pedido").style.display = "block";
  }
</script>
</body>

</html>
