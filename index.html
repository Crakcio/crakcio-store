<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crackio Store</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <h1>Crackio Store</h1>
    <nav>
      <ul>
        <li><a href="#">Inicio</a></li>
        <li><a href="#" onclick="mostrarCarrito()">
          <i class="fas fa-shopping-cart"></i> Carrito (<span id="cantidad-carrito">0</span>)
        </a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section id="productos" class="productos">
      <!-- Productos serán cargados dinámicamente aquí -->
    </section>
  </main>

  <!-- Carrito de compras -->
  <div id="carrito-popup" class="carrito-popup oculto">
    <h3>Tu carrito</h3>
    <ul id="lista-carrito"></ul>
    <p id="total-carrito">Total: S/ 0.00</p>
    <button onclick="cerrarCarrito()">Cerrar</button>
  </div>

  <footer>
    <p>&copy; 2025 Crackio Store. Todos los derechos reservados.</p>
  </footer>

  <script>
    const supabaseUrl = 'https://TU_PROYECTO.supabase.co';
    const supabaseKey = 'TU_PUBLIC_KEY';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const contenedorProductos = document.getElementById("productos");

    async function cargarProductos() {
      const { data: productos, error } = await supabase.from('productos').select('*');

      if (error) {
        console.error("Error al cargar productos:", error.message);
        contenedorProductos.innerHTML = "<p>Error al cargar productos</p>";
        return;
      }

      contenedorProductos.innerHTML = "";

      productos.forEach(producto => {
        const div = document.createElement("div");
        div.className = "producto";
        div.innerHTML = `
          <img src="${producto.imagen_url || 'images/default.jpg'}" alt="${producto.nombre}" />
          <h3>${producto.nombre}</h3>
          <p>${producto.descripcion}</p>
          <p class="precio">S/ ${producto.precio.toFixed(2)}</p>
          <p class="stock">${producto.stock > 0 ? `Stock: ${producto.stock}` : '<span style="color:red">Agotado</span>'}</p>
          ${producto.stock > 0 ? `<button onclick='agregarAlCarrito(${JSON.stringify(producto)})'>Agregar al carrito</button>` : ''}
        `;
        contenedorProductos.appendChild(div);
      });
    }

    // ----- CARRITO -----
    let carrito = [];

    function agregarAlCarrito(producto) {
      const existe = carrito.find(item => item.id === producto.id);
      if (existe) {
        existe.cantidad += 1;
      } else {
        carrito.push({ ...producto, cantidad: 1 });
      }
      actualizarCarrito();
    }

    function actualizarCarrito() {
      const lista = document.getElementById("lista-carrito");
      const cantidadSpan = document.getElementById("cantidad-carrito");
      const totalSpan = document.getElementById("total-carrito");

      lista.innerHTML = "";
      let total = 0;

      carrito.forEach(item => {
        total += item.precio * item.cantidad;
        const li = document.createElement("li");
        li.textContent = `${item.nombre} x${item.cantidad} - S/ ${(item.precio * item.cantidad).toFixed(2)}`;
        lista.appendChild(li);
      });

      cantidadSpan.textContent = carrito.reduce((sum, item) => sum + item.cantidad, 0);
      totalSpan.textContent = `Total: S/ ${total.toFixed(2)}`;
    }

    function mostrarCarrito() {
      document.getElementById("carrito-popup").classList.remove("oculto");
    }

    function cerrarCarrito() {
      document.getElementById("carrito-popup").classList.add("oculto");
    }

    // Iniciar carga
    cargarProductos();
  </script>
</body>
</html>
